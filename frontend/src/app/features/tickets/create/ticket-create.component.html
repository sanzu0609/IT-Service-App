<section class="mx-auto flex w-full max-w-3xl flex-col gap-4">
  <header class="flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-semibold text-slate-900">Create Ticket</h1>
      <p class="text-sm text-slate-600">Describe your issue and set an appropriate priority.</p>
    </div>
    <a class="text-sm font-semibold text-emerald-700 hover:underline" [routerLink]="['/tickets']">Back to list</a>
  </header>

  <form [formGroup]="form" (ngSubmit)="submit()" class="space-y-5 rounded-lg border border-slate-200 bg-white p-6 shadow-sm">
    <div class="flex flex-col gap-2">
      <label class="text-sm font-semibold text-slate-700" for="ticket-subject">Subject</label>
      <input
        id="ticket-subject"
        class="rounded-md border border-slate-300 px-3 py-2 text-sm shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200"
        placeholder="Short summary"
        formControlName="subject"
      />
      <p *ngIf="showError('subject')" class="text-xs text-rose-600">Subject is required.</p>
    </div>

    <div class="flex flex-col gap-2">
      <label class="text-sm font-semibold text-slate-700" for="ticket-description">Description</label>
      <textarea
        id="ticket-description"
        class="min-h-[160px] rounded-md border border-slate-300 px-3 py-2 text-sm shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200"
        placeholder="Provide as much detail as possible"
        formControlName="description"
      ></textarea>
      <p *ngIf="showError('description')" class="text-xs text-rose-600">Description is required.</p>
    </div>

    <div class="grid gap-4 md:grid-cols-2">
      <div class="flex flex-col gap-2">
        <label class="text-sm font-semibold text-slate-700" for="ticket-priority">Priority</label>
        <select
          id="ticket-priority"
          class="rounded-md border border-slate-300 px-3 py-2 text-sm shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200"
          formControlName="priority"
        >
          <option *ngFor="let priority of priorities" [value]="priority">{{ priority }}</option>
        </select>
      </div>
      <div class="flex flex-col gap-2">
        <label class="text-sm font-semibold text-slate-700" for="ticket-category">Category (optional)</label>
        <select
          id="ticket-category"
          class="rounded-md border border-slate-300 px-3 py-2 text-sm shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200"
          formControlName="categoryId"
        >
          <option value="">No category</option>
          <option *ngFor="let category of categories()" [value]="category.id">{{ category.name }}</option>
        </select>
      </div>
    </div>

    <div class="flex flex-col gap-2">
      <label class="text-sm font-semibold text-slate-700" for="ticket-asset">Related asset ID (optional)</label>
      <input
        id="ticket-asset"
        class="rounded-md border border-slate-300 px-3 py-2 text-sm shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200"
        placeholder="e.g., 1234"
        formControlName="relatedAssetId"
      />
    </div>

    <div *ngIf="error()" class="rounded border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700">
      {{ error() }}
    </div>

    <div class="flex items-center gap-3">
      <button
        type="submit"
        class="inline-flex items-center rounded-md bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 disabled:opacity-50"
        [disabled]="loading()"
      >
        {{ loading() ? 'Creating...' : 'Create ticket' }}
      </button>
      <span *ngIf="loading()" class="text-xs text-slate-500">Submitting...</span>
    </div>
  </form>
</section>
