<div class="flex min-h-screen flex-col bg-slate-50 text-slate-900">
  <header class="border-b border-slate-200 bg-white">
    <div class="mx-auto flex w-full max-w-6xl items-center justify-between px-4 py-3">
      <div class="text-lg font-semibold">ITSM Mini</div>
      <nav class="flex items-center gap-4 text-sm font-medium">
        <a
          *ngIf="canSeeTickets()"
          routerLink="/tickets"
          routerLinkActive="text-emerald-600"
          class="hover:text-emerald-500"
        >
          Tickets
        </a>
        <a
          *ngIf="canSeeUsers()"
          routerLink="/admin/users"
          routerLinkActive="text-emerald-600"
          class="hover:text-emerald-500"
        >
          Users
        </a>
        <a
          *ngIf="canSeeDepartments()"
          routerLink="/admin/departments"
          routerLinkActive="text-emerald-600"
          class="hover:text-emerald-500"
        >
          Departments
        </a>
        <div class="relative">
          <button
            type="button"
            class="flex items-center gap-2 rounded border border-transparent px-3 py-1 text-slate-600 transition hover:bg-slate-100"
            (click)="toggleUserMenu()"
          >
            <span>{{ user()?.fullName ?? user()?.username ?? 'Account' }}</span>
            <svg
              class="h-4 w-4 text-slate-500 transition"
              [class.rotate-180]="showUserMenu()"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
            >
              <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
            </svg>
          </button>

          <div
            *ngIf="showUserMenu()"
            class="absolute right-0 z-10 mt-2 w-48 rounded-md border border-slate-200 bg-white shadow-lg"
          >
            <button
              type="button"
              class="flex w-full items-center gap-2 px-4 py-2 text-left text-sm text-slate-700 hover:bg-slate-100"
              (click)="openChangePassword(); closeUserMenu()"
            >
              Change password
            </button>
            <button
              type="button"
              class="flex w-full items-center gap-2 px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 disabled:opacity-50"
              (click)="logout(); closeUserMenu()"
              [disabled]="loggingOut()"
            >
              Sign out
            </button>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <main class="relative mx-auto flex w-full max-w-6xl flex-1 px-4 py-6" (click)="closeUserMenu()">
    <router-outlet />
  </main>

  <app-change-password-modal
    [open]="isModalOpen()"
    [forced]="forceChangePassword()"
    (closed)="handleModalClosed()"
    (passwordChanged)="handlePasswordChanged()"
  ></app-change-password-modal>
  <app-toast-container></app-toast-container>
</div>
